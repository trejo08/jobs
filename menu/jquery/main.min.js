var preventUnload=false;var observer=(function(){var f=[],e=function(){a("publicadores-seguidos",function(g){$("#capa_publicador_listado_empresas_seguidas").html(g)})},d=function(h){var g;topic=h&&f[h];if(!topic){g=$.Callbacks();topic={publish:g.fire,subscribe:g.add,unsubscribe:g.remove};if(h){f[h]=topic}}return topic},b=function(i){var g=(2<=arguments.length)?Array.prototype.slice.call(arguments,1):[];var h=d(i);return h.publish.apply(h,g)},a=function(h,g){return d(h).subscribe(g)},c=function(h,g){return d(h).unsubscribe(g)};return{init:e,publish:b,subscribe:a,unsubscribe:c}})();var browser=(function(){var h=function(i){window.location.href=i},e=function(){if(g()){urlredirect=c();h(urlredirect)}else{window.location.reload()}},d=function(){$(this).parents(".tab-content").parent().find("#tab-selector li.active a").click()},g=function(){var i=window.location.hash.substr(1);if(i.length&&i.substr(0,1)=="!"&&i.substr(1).length){return i.substr(1)}return false},f=function(){var i=window.location.hash.substr(1);if(g()){$("[data-action="+i.substr(1)+"]").first().click();b()}},c=function(){var i=window.location.href.split("#!");return i[0]},b=function(){window.location.replace("#");if(typeof window.history.replaceState=="function"){history.replaceState({},"",window.location.href.slice(0,-1))}},a=function(){var j=$.Deferred();if(navigator.geolocation){var i=10*1000*1000;navigator.geolocation.getCurrentPosition(function(k){j.resolve(k)},function(k){switch(k.code){case 1:j.reject("permissionDenied");break;case 2:j.reject("positionUnavailable");break;case 3:j.reject("timeout");break}},{enableHighAccuracy:true,timeout:i,maximumAge:0})}else{j.reject("notSupported")}return j.promise()};return{redirect:h,reload:e,reloadTab:d,hasFragment:g,processFragment:f,clearUrl:b,getGeolocation:a}})();var alerts=(function(){var e=function(f){$("body").on("click","[data-action=show-alert]",a);bootbox.setDefaults({locale:$("html").attr("lang")=="pt"?"br":$("html").attr("lang"),show:true,backdrop:true,closeButton:true,animate:true})},d=function(f){if(f!=null){bootbox.alert(f)}},c=function(f){var g=$.Deferred();if(f!=null){bootbox.confirm(f,function(h){if(h){g.resolve()}else{g.reject()}})}else{g.reject()}return g.promise()},a=function(g){g.preventDefault();var h=$(this);var f=h.attr("data-message");d(f);h.trigger("alert")},b=function(g){g.preventDefault();var h=$(this);var f=h.attr("data-message");$.when(c(f)).done(function(){h.trigger("confirm")}).fail(function(){h.trigger("noconfirm")})};return{init:e,showAlert:d,showConfirm:c,dispatchAlert:a,dispatchConfirm:b}})();var formulario=(function(){var h=null,w=function(){$("body").on("submit","form[data-type='estandar']",n);$("body").on("submit","form[data-type='confirm']",m);$("body").on("success","form[data-response='reload']",browser.reload);$("body").on("success","form[data-response='reload-tab']",browser.reloadTab);$("body").on("click","[data-action=toggle-form]",j);$("body").on("click","[data-action=show-form]",u);$("body").on("click","[data-action=hide-form]",v);$("body").on("click","#globalMessageLayer .close",x);a()},e=function(){var y=$("body").find("span[class=spinnerLoading]").clone().show();h.find("[type=submit]").append(y)},f=function(){h.find("[type=submit] span[class=spinnerLoading]").remove()},c=function(){var y=h.find('input[type="submit"], button');y.prop("disabled",true)},l=function(){var y=h.find('input[type="submit"], button');y.prop("disabled",false)},k=function(){o(h);var y=h.find("input, textarea, select, radio, checkbox");y.each(function(){$(this).closest(".form-group").removeClass("has-error").find(".glyphicon-warning-sign").remove();$(this).removeAttr("title data-original-title")});var z=h.find("#s2id_p_select_habilidad");z.each(function(){$(this).closest(".form-group").removeClass("has-error").find(".glyphicon-warning-sign").remove();$(this).removeAttr("title data-original-title")})},d=function(A,y){var z=s(h,y,false).promise();if(A&&typeof A!="undefined"){$.each(A,function(D,E){var B=(h.find("#"+D).length>0)?"#"+D:"input[name^="+D+"]";if(D=="p_habilidad"){B=h.find("#p_select_habilidad");habilidades.validarEtiquetas()}var C=h.find(B).closest(".form-group").addClass("has-error").find(".control-label");if(h.find(B).closest(".form-group").hasClass("hide")){h.find(B).closest(".form-group").removeClass("hide")}if(C.find(".glyphicon-warning-sign").length==0){C.prepend('<span class="glyphicon glyphicon-warning-sign"></span>')}if(h.find(B).hasClass("hide")){h.find(B).removeClass("hide")}h.find(B).attr("data-toggle","tooltip");h.find(B).attr("data-original-title",E);if(h.find(B).parents(".collapse").length>0){h.find(B).parents(".collapse").removeClass("collapse")}if(z){z.done(function(){if(D=="p_habilidad"){B.tooltip("show")}else{h.find(B).focus()}})}z=null})}},s=function(z,C,y){var B=(y)?"bs-callout bs-callout-success":"bs-callout bs-callout-danger";var A=z.find("#formErrorLayer");if(C!=null){A.removeClass().addClass(B).find("p");A.html(C);A.slideDown()}return A},o=function(y){y.find("#formErrorLayer").hide()},t=function(z,y){if(z&&y){var A=$("#globalMessageLayer");A.removeClass("alert*").attr("class","alert alert-"+y).html(z+'<button type="button" class="close" aria-hidden="true">&times;</button>').fadeIn();return A}},a=function(){var y=$("form").first();p(y)},p=function(y){y.find("input:not([class*=select2],[class*=tt-hint],[type*=hidden]), textarea, select").first().focus()},g=function(y){k();y.trigger("show");y.slideDown();p(y)},i=function(y){y.slideUp()},j=function(){var y=$(this).attr("data-target");if(!$(this).attr("data-nohide")&&$("#"+y+":visible").length){$("#"+$(this).attr("data-hide-target")).hide();$("#"+y+":visible").slideUp()}else{$(this).each(u)}if(!$(this).attr("data-noprevent")){return false}},u=function(){var B=$(this).attr("data-target");h=$("#"+B);r();var z=$(this).attr("data-hide-target");$("#"+z).hide();var y=$(this).attr("data-append-to");if(typeof y!="undefined"){h.appendTo("#"+y)}if(h[0]&&typeof(h[0].reset)=="function"){h[0].reset();var A=(typeof $(this).attr("data-params")!="undefined"&&$(this).attr("data-params").length)?$.parseJSON($(this).attr("data-params")):{};$.each(A,function(C,D){element=h.find("#"+C);if(element.is(":checkbox")){element.attr("checked",D);element.change()}else{if($().datepicker!=undefined){if(element.hasClass("date")){element.datepicker("setDate",D)}else{if(element.parent().hasClass("date")){element.parent().datepicker("setDate",D)}else{element.val(D)}}}else{element.val(D)}}})}g(h);if(!$(this).attr("data-noprevent")){return false}},v=function(){var y=$(this).attr("data-show-target");h=$("#"+y);g($("#"+y));var z=$(this).attr("data-target");i($("#"+z));b();if(!$(this).attr("data-noprevent")){return false}},n=function(z){h=$(this);var y=h.attr("action");var A=h.serialize();c();$.ajax({url:y,type:"post",dataType:"json",data:A,async:true,beforeSend:function(){e();k();h.trigger("beforeSend")},success:function(B){if(B.url==undefined){f();if(B.success==true){b();if(h.attr("data-response-show")||h.attr("data-response-hide")){$("#"+h.attr("data-response-hide")).hide();$("#"+h.attr("data-response-show")).show()}if(h.attr("data-html")&&B.html){$("#"+h.attr("data-html")).html(B.html)}else{h.trigger("success",[B])}}else{d(B.errors,B.message);h.trigger("error",[B])}l()}else{b();browser.redirect(B.url)}},error:function(){s(h,null,false);f();l()}});return false},r=function(){if($("#formEditarPerfilPrivado").length>0){preventUnload=true;$("#formEditarPerfilPrivado").closest(".container").find(".btn , a, form").addClass("disabled");$("#formEditarPerfilPrivado").closest(".container").find("input, select").attr("disabled",true);if(h.attr("id")=="formEditarPerfilPrivado"){$("#formEditarPerfilPrivado").closest(".col-md-4").find(".btn , a, form").removeClass("disabled");$("#formEditarPerfilPrivado").closest(".col-md-4").find("input, select").attr("disabled",false)}else{h.removeClass("disabled");h.find(".btn , a").removeClass("disabled");h.find("input, select").attr("disabled",false)}}},b=function(){if($("#formEditarPerfilPrivado").length>0){preventUnload=false;$("#formEditarPerfilPrivado").closest(".container").find(".btn , a, form").removeClass("disabled");$("#formEditarPerfilPrivado").closest(".container").find("input, select").attr("disabled",false)}},x=function(y){y.preventDefault();$(this).parent().fadeOut(function(){$(this).removeClass().html("")})},q=function(){var y=browser.getGeolocation();$.when(y).done(function(z){$("#p_coords").val(z.coords.longitude+","+z.coords.latitude)}).fail(function(){})},m=function(){var y=$(this);$.when(alerts.showConfirm(y.attr("data-message"))).done(function(){y.each(formulario.sendForm)});return false};return{init:w,sendForm:n,showMessageLayer:s,hideMessageLayer:o,showGlobalMessageLayer:t,hideFormulario:i,showFormulario:g,setFormCoordinates:q}})();var validations=(function(){var c=function(){$("body").on("keypress","[data-accept='int']",a);$("body").on("keypress","[data-accept='decimal']",b)},a=function(d){var e=window.Event?true:false;var f=e?d.which:d.keyCode;return(f<=13||(f>=48&&f<=57))},b=function(d){var e=window.Event?true:false;var f=e?d.which:d.keyCode;return(f<=13||(f>=48&&f<=57)||f==46)};return{init:c}})();var boton=(function(){var e=null,g=function(){$("body").on("click","[data-type='enlace'][data-url]",f);$("body").on("click","[data-type='ajax'][data-url]",a);$("body").on("click","[data-type='confirm'][data-url]",h);$("body").on("click","[data-action=submit-form]",d);$("body").on("click","[data-action=redirect]",c);$("body").on("success","[data-response='reload']:not(form)",browser.reload);$("body").on("success","[data-response='reload-tab']:not(form)",browser.reloadTab);$("body").on("keypress","[data-type='search'] input",function(j){if(j.which==13){j.preventDefault();$(this).parents("[data-type='search']").find("button").click()}})},f=function(){if(e==null){e=$(this)}if(!$(this).hasClass("noLoading")){c()}browser.redirect(e.attr("data-url"))},d=function(){e=$(this);c();$("#"+$(this).attr("data-target")).submit();$("#"+$(this).attr("data-target")).on("success",i);$("#"+$(this).attr("data-target")).on("error",i)},c=function(){if(e==null){e=$(this)}var j=$("body").find("span[class=spinnerLoading]").clone().show();e.append(j);e.attr("disabled",true)},i=function(){e.find("span[class=spinnerLoading]").remove();e.attr("disabled",false)},a=function(){e=$(this);var l=e.attr("data-url");var j=e.attr("data-params");var n={};if(j!=undefined){n=$.parseJSON(j)}var o=e.attr("data-method")!=undefined?e.attr("data-method"):"post";var k=e.attr("data-response-type")!=undefined?e.attr("data-response-type"):"json";var m=e.attr("data-async")!="false"?true:false;$.ajax({url:l,type:o,dataType:k,data:n,async:m,beforeSend:function(){if(!e.hasClass("noLoading")){c()}e.trigger("beforeSend")},success:function(p){if(p.url==undefined){i();if(p.success==true){if(e.attr("data-error")){$("#"+e.attr("data-error")).hide()}if(e.attr("data-response-show")||e.attr("data-response-hide")){$("#"+e.attr("data-response-hide")).hide();$("#"+e.attr("data-response-show")).show()}if(e.attr("data-html")&&p.html){if(e.attr("data-append-html")){$("#"+e.attr("data-html")).append(p.html)}else{$("#"+e.attr("data-html")).html(p.html)}}else{e.trigger("success",[p])}}else{e.trigger("error",[p]);if(e.attr("data-error")&&p.message){$("#"+e.attr("data-error")).html(p.message);$("#"+e.attr("data-error")).show()}}}else{browser.redirect(p.url)}if(typeof p.attributes!="undefined"){b(e,p.attributes)}},error:function(){i();alerts.showAlert("Internal server error. Try again later.")}});return false},b=function(k,j){$.each(j,function(l,m){if(l!=0){if(l.substr(0,4)=="data"){k.attr(l,m)}else{k[l](m)}}})},h=function(){var j=$(this);$.when(alerts.showConfirm(j.attr("data-message"))).done(function(){j.each(boton.sendRequest)})};return{init:g,irEnlace:f,sendRequest:a,setAttributes:b}})();var ajax=(function(){var c=function(e){var d=e.attr("data-url");var f=typeof e.attr("data-params")!="undefined"?$.parseJSON(e.attr("data-params")):{};return $.post(d,f)},a=function(d){d.preventDefault();var e=$(this);$.when(alerts.showConfirm(e.attr("data-message"))).done(function(){$.when(ajax.post(e)).done(function(f){e.trigger("confirm",[f])})})},b=function(d,e,g){var f=$.Deferred();var i=$("#"+e+"_loading");var h=$("#"+e);if(!h.hasClass("noScroll")){$(document).scrollTop(0)}if(i.length>0){i.show();h.hide()}h.load(d,g,function(j){if(i.length>0){i.hide()}h.fadeIn();var k=h.promise();k.done(function(){f.resolve()})});return f.promise()};return{post:c,postConfirm:a,loadLayer:b}})();var vista=(function(){var n=function(){var q=$(".subir");q.on("click",l);$(window).on("scroll",vista.toggleSubirBtn);$("#remote-content-menu").sidr({name:"sidr-remote-content"});$("body").tooltip({selector:"[data-toggle=tooltip]"});$("body").on("click","a[data-action=paginate]",i);$("body").on("click","a[data-action=view-more]",e);$("body").on("keyup","[data-action=char-counter]",m);$("body").on("focusin","[data-action=char-counter]",k);$("body").on({mouseenter:function(){$(this).attr("data-origin",$(this).html());$(this).html($(this).attr("data-hover-content"))},mouseleave:function(){$(this).html($(this).attr("data-origin"))}},"a[data-hover-content]");$("body").on("click","[data-action=load-tab-content]",j);$("body").on("click","[data-action=click-on-element]",o);$("body").on("click","[data-action=toggle-element]",h);var r=$("[data-action=seleccionar-provincia]");r.on("change",d);a();c();b();$("body").on("click","[data-action=aceptar-cookie]",f);$("#iniciarSesion").on("shown.bs.dropdown",function(){var s=$(this);setTimeout(function(){s.find("input:not([class*=select2],[type*=hidden]), textarea, select").first().focus()},100)});$("body").on("click",".btn.disabled , a.disabled, form.disabled",function(s){if($("#formEditarPerfilPrivado").length>0){s.stopImmediatePropagation();return false}})},j=function(u){u.preventDefault();var r=$(this);var s,v={};if(r.is("form")){s=r.attr("action");v=r.serialize()}else{s=r.attr("data-url");var q=r.attr("data-params");if(q!=undefined){v=$.parseJSON(q)}}var t=ajax.loadLayer(s,r.attr("data-target"),v);$.when(t).done(function(){r.trigger("success")})},i=function(s){var r="listado";if($(this).attr("data-target").length>0){r=$(this).attr("data-target")}var q=ajax.loadLayer($(this).attr("href"),r);$.when(q).done(function(){a});return false},e=function(q){q.preventDefault();var r=parseInt($(this).attr("data-group"));var s=$(this).attr("data-group-max");$(this).parent().find('[data-group*="'+r+'"]').removeClass("hide");if(r==s){$(this).hide()}$(this).attr("data-group",r+1)},l=function(q){q.preventDefault();$("html, body").animate({scrollTop:0},300)},p=function(){var q=$(".subir");if($(this).scrollTop()>200){q.fadeIn(200)}else{q.fadeOut(200)}},o=function(q){q.preventDefault();var r=$(this);$("#"+r.attr("data-id-target")).click()},h=function(q){q.preventDefault();var r=$(this);$("#"+r.attr("data-target")).toggle()},m=function(){var s=$(this);var r=s.val();var q=s.attr("limit");if(r.length>q){s.prev(".count").addClass("has-error").html(q-r.length)}else{s.prev(".count").removeClass("has-error").html(q-r.length)}},k=function(){var s=$(this);if(!s.prev(".count").length){var r=s.val();var q=s.attr("limit");if(r.length>0){q-=r.length}s.before('<p class="count'+(q<0?" has-error":"")+'">'+q+"</p>")}},d=function(){var q=/[0-9]*\|$/;if($(this).val().match(q)){$("#label_pais").closest(".form-group").removeClass("hide")}else{$("#label_pais").closest(".form-group").addClass("hide")}},a=function(q){if(typeof indeed!="undefined"){for(var q in indeed){g(q)}}},g=function(q){ajax.loadLayer("/ajax/indeed",q,indeed[q]);indeed[q]["start"]=parseInt(indeed[q]["start"])+5},c=function(){if($("div[data-hotwords]").length){var q=$("div[data-hotwords]").attr("data-hotwords");if(!$("script[src='"+q+"']").length){$.getScript(q)}}},b=function(){if($("#cookie_policy").length){$("#cookie_policy").html(cookie_policy)}},f=function(q){q.preventDefault();$("#cookie_policy").remove()};return{init:n,toggleSubirBtn:p,loadTabContent:j}})();var notificaciones=(function(){var g=function(){b();$("body").on("click","[data-action=aceptar-cancelar-notificacion]",c);$("body").on("click","[data-action=close-notificacion]",a);var i=$("[data-action=listado-notificaciones]");i.on("click",e)},h=function(){$("[data-action=notified]").each(function(){f($(this))})},b=function(){if($("[data-action=notified]").length){h()}},f=function(i){$.when(ajax.post(i)).done(function(j){if(j!=undefined&&j.success){if(j.url!=undefined){browser.redirect(j.url)}else{$parentObj=i.closest(".notificacion-group");i.closest("li").remove();if($parentObj.find("li").length==0){$parentObj.remove()}d(j)}}})},a=function(i){i.stopPropagation();f($(this))},c=function(i){i.stopPropagation();f($(this))},e=function(i){i.preventDefault();$target=$("#"+$(this).attr("data-target"));var j=$("body").find("#capa-notificaciones-loading").clone().removeClass("hide");$target.html("").append(j);$.when(ajax.post($(this))).done(function(k){if(k!=undefined&&k.success){if(k.html!=undefined&&k.html){$target.hide().html(k.html).slideDown("slow")}else{$target.html("")}d(k)}})},d=function(i){if(i.data!=undefined&&i.data.num_notificaciones!=undefined){if(i.data.num_notificaciones==0){$(".centro-notificaciones .label-danger strong").html(i.data.num_notificaciones);$(".centro-notificaciones .label-danger").addClass("hide")}else{$(".centro-notificaciones .label-danger strong").html(i.data.num_notificaciones);$(".centro-notificaciones .label-danger").removeClass("hide")}}};return{init:g,notificar:h,badgeUpdate:d}})();var modalColectivos=(function(){var c=function(){a();var d=$("#formCambioColectivo");d.on("submit",formulario.sendForm);d.on("success",b)},a=function(){if($("#cambioColectivoModal").length>0){var d=$("#cambioColectivoModal");d.modal()}},b=function(){$("#cambioColectivoModal").modal("hide")};return{init:c}})();var etiquetaVATID=(function(){var b=function(){var c=$("[data-action=obtener-etiqueta-vatid]");c.on("change",a)},a=function(d){d.preventDefault();var e=$(this);var c={};c.p_value=e.val();e.attr("data-params",'{"p_value": "'+e.val()+'"}');$.when(ajax.post(e)).done(function(f){if(f!=undefined&&f.success==true){var g=e.attr("data-target");$("#"+g).html(f.value)}})};return{init:b}})();var buscador=(function(){var g=function(){var k=$("a[data-action=frmBuscadorEnlace]");k.on("click",b);var h=$("a[data-action=frmBuscadorColectivo]");h.on("click",f);var j=$("a[data-action=colectivosVertical]");j.on("click",d);var i=$("a[data-action=modoVertical]");i.on("click",e);var l=$("#frmBuscador");l.on("submit",a)},c=function(){var h=$("body").find("span[class=spinnerLoading]").clone().show();$form.find("[type=submit]").append(h).prop("disabled",true)},b=function(h){h.preventDefault();$("#frmBuscadorTitulo").html('<i class="icon-list-alt"></i>'+$(this).html());$("#frmBuscador").attr("data-tipo-busqueda",$(this).attr("href"))},f=function(h){h.preventDefault();$("#frmBuscadorColectivo").html('<i class="icon-list-alt"></i>'+$(this).html());$("#frmBuscador").attr("data-all-groups",$(this).attr("data-all-groups"))},e=function(h){h.preventDefault();$("#frmBuscador").attr("data-all-groups",$(this).attr("data-all-groups"));$("#frmBuscador").submit()},d=function(h){h.preventDefault();if($(this).attr("data-all-groups")=="no"){document.cookie="allg=;path=/"}else{document.cookie="allg=1;path=/"}$url=$(this).attr("href");if($url=="#"){$("#frmBuscador").attr("data-all-groups",$(this).attr("data-all-groups"));$("#frmBuscador").submit()}else{browser.redirect($url)}},a=function(k){$form=$(this);k.preventDefault();c();var i=$(this).attr("data-tipo-busqueda");var l=$(this).attr("data-tipo-actual");var h=$(this).attr("data-all-groups");var j=$(this).attr("action")+"?cadena="+$("#frmBuscadorCadena").val()+"&url_busqueda="+i;j+="&allgroups="+h;if(i==l){j+="&"+$("#frmBuscador-filter-params").val()}$.get(j,function(m){browser.redirect(m.url)},"json")};return{init:g}})();var menuUsuario=(function(){var d=function(){var e=$("#formLogin");if($("#p_coords").length){formulario.setFormCoordinates()}e.on("submit",formulario.sendForm);e.on("success",browser.reload);var g=$("#formConfirmarPassFB");g.on("submit",formulario.sendForm);g.on("success",browser.reload);var f=$("a[data-name=seleccionar-empresa]");f.on("click",c)},b=function(){var e=$("body").find("span[class=spinnerLoading]").clone().show();$boton.append(e);$boton.attr("disabled",true)},c=function(e){$boton=$(this);e.preventDefault();b();$.when(ajax.post($(this))).done(a)},a=function(e){if(e.url==undefined){browser.reload()}else{browser.redirect(e.url)}};return{init:d}})();var subirFicheros=(function(){var c=function(){if($.fn.fileupload){var d=$("[data-action=subirFichero]");d.each(function(){var e={p_uniqid:$("#uniqid").val()};var f=$(this);f.fileupload({dataType:"json",formData:e,maxNumberOfFiles:1,dropZone:f.find(".dropZone"),autoUpload:true,start:function(h,g){f.find(".progress .progress-bar").css("width","0%");f.find(".progress").show("fast");f.find("#formErrorLayer").slideUp()},done:function(h,g){if(g.result.success==true){if(g.result.imagen!=undefined){f.find(".dropZone").html(g.result.imagen)}f.trigger("uploaded",[g.result])}else{f.trigger("noUploaded",[g.result])}f.find(".progress").hide()},progress:function(i,h){var g=parseInt(h.loaded/h.total*100,10);f.find(".progress .progress-bar").width(g+"%")}})})}},b=function(){obj=$(this);var d=obj.attr("data-url");window.location.href=d;return false},a=function(){obj=$(this);var d=obj.attr("data-url");var e={p_fichero:obj.attr("data-value"),p_uniqid:$("#uniqid").val()};$.ajax({url:d,type:"post",dataType:"json",data:e,async:true,success:function(f){if(f!=undefined&&f.success==true){obj.parent().parent().parent().remove()}else{$("#mensajes-ficheros").html(f.message).slideDown()}}});return false};return{init:c,verFichero:b,borrarFichero:a}})();var foto=(function(){var i=function(){$("body").on("show","#formEditarFoto",h);if($.fn.fileupload){b()}$("a[name='rotar']").unbind("click");$("a[name='rotar']").click(g);var k=$("#formEditarFoto");k.on("submit",c);k.on("submit",formulario.sendForm);k.on("success",a);var j=$("a[data-action=btnBorrarFoto]");j.on("click",ajax.postConfirm);j.on("confirm",f)},h=function(){$("#nuevaFoto").find(".progress").hide();$(".cropper").cropper({data:{width:"200px"},aspectRatio:1,preview:".img-preview"})},b=function(){var j=$("#formEditarFoto");$("#editar_imagen").fileupload({dataType:"json",autoUpload:true,add:function(l,k){k.submit();return false},start:function(l,k){j.find(".progress .progress-bar").css("width","0%");j.find(".progress").show("fast");j.find("#formErrorLayer").slideUp();return false},done:function(l,k){if(k.result.success==true){d(k.result.src,k.result.orig,0)}else{formulario.showMessageLayer(j,k.result.message,false)}j.find(".progress").hide();return false},progress:function(m,l){var k=parseInt(l.loaded/l.total*100,10);j.find(".progress .progress-bar").width(k+"%");return false}})},d=function(k,l,j){$("#img-cropper").fadeOut("fast",function(){$(".cropper").cropper("setImgSrc",k);$(".cropper").attr("data-angulo",j);$(".cropper").attr("data-orig",l)});$("#img-cropper").fadeIn()},a=function(k,j){k.preventDefault();formulario.hideFormulario($(this));$("#"+$(this).attr("data-target")).slideDown();$(".cropper").attr("data-angulo","0");$("#user_logo,#publicador_logo").html(j.imagen);$("#p_tiene_logo").val("1");$("#p_logo_pub_name").val(j.filename);$("#user_logo_menu").html(j.imagen);$("#borrar_foto,#borrar_logo").removeClass("hide");$("#fotoError").addClass("hide");$("#p_tiene_logo").val("1");$("#p_foto_crop").val(j.cropInfo);$("#p_logo_tmp").val($("input[name=params]").val())},f=function(k,j){if(j!=undefined&&j.success==true){$("#user_logo,#publicador_logo").html(j.imagen);$("#user_logo_menu").html(j.imagen);$("#borrar_foto, #borrar_logo").addClass("hide");$("#editar_imagen").addClass("addimagen");$("#fotoError").addClass("hide");$(".cropper").attr("data-orig","");$(".cropper").attr("data-angulo","0");$(".cropper").cropper("setImgSrc",j.src);$("#p_tiene_logo").val("0")}else{formulario.showMessageLayer(formEditarFoto,j.message,false)}},g=function(){var k=$("#formEditarFoto");var j=$(".cropper");var l="src="+j.attr("src")+"&id="+j.attr("data-id");l+="&nombre="+j.attr("title")+"&angulo="+j.attr("data-angulo");l+="&sentido="+$(this).attr("data-sentido");if(j.attr("data-pais")){l+="&pais="+j.attr("data-pais")}if(j.attr("data-orig")){l+="&tmp="+j.attr("data-orig")}$.ajax({url:$(this).attr("data-url"),data:l,type:"POST",dataType:"json",async:false,success:function(m){if(m.error){formulario.showMessageLayer(k,m.error,false)}else{d(m.src,$(".cropper").attr("data-orig"),m.angulo)}}});return false},c=function(){var j=$(".cropper").cropper("getData");j.id=$(".cropper").attr("data-id");j.angulo=$(".cropper").attr("data-angulo");if($(".cropper").attr("data-orig")){j.orig=$(".cropper").attr("data-orig")}$("input[name=params]").val(JSON.stringify(j));return false},e=function(j){h();d(j,null,0)};return{init:i,resetCropper:e}})();var utils=(function(){var a=function(d){var d=d.toLowerCase();d=d.replace(/[áàäâå]/g,"a");d=d.replace(/[éèëê]/g,"e");d=d.replace(/[íìïî]/g,"i");d=d.replace(/[óòöô]/g,"o");d=d.replace(/[úùüû]/g,"u");d=d.replace(/[ýÿ]/g,"y");d=d.replace(/[ñ]/g,"n");d=d.replace(/[ç]/g,"c");d=d.replace(/['"]/g,"");d=d.replace(/[^a-zA-Z0-9-]/g,"-");d=d.replace(/\s+/g,"-");d=d.replace(/(_)$/g,"-");d=d.replace(/^(_)/g,"-");return d},c=function(e){var f={};var d=e.serializeArray();$.each(d,function(){if(f[this.name]!==undefined){if(!f[this.name].push){f[this.name]=[f[this.name]]}f[this.name].push(this.value||"")}else{f[this.name]=this.value||""}});return f},b=function(d){$(":input",d).each(function(){var f=this.type;var e=this.tagName.toLowerCase();if(f=="text"||f=="password"||f=="hidden"||e=="textarea"){this.value=""}else{if(f=="checkbox"||f=="radio"){this.checked=false}else{if(e=="select"){this.selectedIndex=-1}}}})};return{permalink:a,serializeObject:c,clearForm:b}})();var habilidades=(function(){init=function(){if($.fn.typeahead){crearTypeHead();$("#p_select_habilidad").on("keydown",function(a){if(a.keyCode=="188"){a.preventDefault();getEtiqueta()}if(a.keyCode=="13"){a.preventDefault()}});$("#p_select_habilidad").on("keyup",function(a){if(a.keyCode=="13"){a.preventDefault();getEtiqueta()}});$("[data-action=aniadir-etiqueta]").on("click",function(a){a.preventDefault();getEtiqueta()});$("#p_select_habilidad").on("typeahead:selected",function(c,b){if(b.value.length<3){return false}var d=$("#p_habilidad").val().split(",");var a=b.value.split(",");$.each(a,function(f,h){h=$.trim(h);var e=jQuery.grep(d,function(i){if(i==h){return true}return false});if(e.length==0){if(validarEtiqueta(h)){var g=$("#p_habilidad").val().split(",");if(g[0]==""){g=new Array()}g.push(h);$("#p_habilidad").val(g.join(","));aniadirEtiqueta(h,true);$("#p_select_habilidad").val("")}else{aniadirEtiqueta(h,false)}}});$("#p_select_habilidad").typeahead("setQuery","")});$("body").on("click","[data-action=borrarHabilidad]",borrarEtiqueta);loadEtiquetas()}},refrescarAutocompletar=function(){if($("#p_select_habilidad").attr("data-prefetch")){$("#p_select_habilidad").typeahead("destroy");crearTypeHead()}},crearTypeHead=function(){var b=$("#p_fk_id_dominio_colectivo").val();if(!b){b="generico"}var a=$("#p_select_habilidad").attr("data-prefetch");if(b){a=a.replace("generico",b)}$("#p_select_habilidad").typeahead([{name:"habilidades_"+b,prefetch:{url:a,filter:function(d){var c=new Array();$.each(d,function(e,f){c.push({value:f,tokens:[f]})});return c}}}])},borrarEtiqueta=function(c){c.preventDefault();var b=$(this);var d=$("#p_habilidad").val().split(",");var e=b.closest("span");var a=e.text();d=jQuery.grep(d,function(f){if($.trim(f)!=$.trim(a)){return true}});$("#p_habilidad").val(d.join(","));e.remove();if(!validarEtiqueta(a)){$hayInvalidas=false;$.each($("a[data-action='borrarHabilidad']"),function(){if(!validarEtiqueta($(this).closest("span").text())){$hayInvalidas=true}});if(!$hayInvalidas){$("#msg-error-habs").hide()}}},aniadirEtiqueta=function(b,c){$(".typeaheadContent").prev().removeClass("hide");var a=(!c)?"has-error":"";$tag=$(".typeaheadContent").append('<span class="label label-default '+a+'">'+b+'<a data-action="borrarHabilidad" href="#"><span class="glyphicon glyphicon-trash"></span></a></span>');if(!c){$("#msg-error-habs").show()}},getEtiqueta=function(){var a={value:$("#p_select_habilidad").val()};$("#p_select_habilidad").trigger("typeahead:selected",$("#p_select_habilidad"),a)},loadEtiquetas=function(){$(".typeaheadContent").prev().addClass("hide");$(".typeaheadContent").html("");var a=$("#p_habilidad").val().split(",");if(a[0]==""){a=new Array()}$.each(a,function(b,c){aniadirEtiqueta(c,true)})},validarEtiqueta=function(a){if(!(/^[a-z0-9áéíóúàèìòùäëïöüâêîôûñçãẽĩõũ][a-z0-9áéíóúàèìòùäëïöüâêîôûñçãẽĩõũ\+\-\.\/\#&\s]{2,29}$/).test($.trim(a).toLowerCase())){return false}return true},validarEtiquetas=function(){var a=$("#p_habilidad").val().split(",");$(".typeaheadContent span.label").each(function(b){value=$(this).text();if(!(/^[a-z0-9áéíóúàèìòùäëïöüâêîôûñçãẽĩõũ][a-z0-9áéíóúàèìòùäëïöüâêîôûñçãẽĩõũ\+\-\.\/\#&\s]{2,29}$/).test($.trim(value).toLowerCase())){$(this).addClass("has-error")}})};return{init:init,loadEtiquetas:loadEtiquetas,getEtiqueta:getEtiqueta,validarEtiquetas:validarEtiquetas,refrescarAutocompletar:refrescarAutocompletar}})();var widgets=(function(){var d=function(){a();var e=$("[data-action=import-contacts]");e.on("click",b)},a=function(){if($("[data-action=cargar-mirones-profesionales]").length>0){$("[data-action=cargar-mirones-profesionales]").removeClass("hide");$.when(ajax.post($("[data-action=cargar-mirones-profesionales]"))).done(function(e){if(e.length>0){$("[data-action=cargar-mirones-profesionales]").html(e)}else{$("[data-action=cargar-mirones-profesionales]").addClass("hide")}})}if($("[data-action=cargar-mirones-publicadores]").length>0){$("[data-action=cargar-mirones-publicadores]").removeClass("hide");$.when(ajax.post($("[data-action=cargar-mirones-publicadores]"))).done(function(e){if(e.length>0){$("[data-action=cargar-mirones-publicadores]").html(e)}else{$("[data-action=cargar-mirones-publicadores]").addClass("hide")}})}},b=function(e){e.preventDefault();if($(this).attr("target")=="_self"){browser.redirect($(this).attr("data-url"))}else{window.open($(this).attr("data-url"),$(this).attr("data-redirect"),"width=600,height=600,scrollbars=yes")}},c=function(f,g,e){$tab=$("#"+f+"_contacts");if($tab.length>0){usuario.loadTabContactos($tab,g)}else{browser.redirect(e)}};return{init:d,loadContactos:c}})();var valoraciones=(function(){var i=function(){$("body").on("click","a[data-action=rechazar-valoracion]",ajax.postConfirm);$("body").on("click","a[data-action=aceptar-valoracion]",boton.sendRequest);$("body").on("success","a[data-action=aceptar-valoracion]",d);$("body").on("confirm","a[data-action=rechazar-valoracion]",e);$("body").on("click","[data-action=redactar-valoracion]",a);$("body").on("submit","#formEnviarValoracion",formulario.sendForm);$("body").on("success","#formEnviarValoracion",c);$("body").on("click","#formEnviarValoracion input[type=radio]",b);$("body").on("change","#formEnviarValoracion #p_receptor",b);$("body").on("click","a[data-action=add-valoracion]",boton.sendRequest);$("body").on("success","a[data-action=add-valoracion]",h);$("body").on("error","a[data-action=add-valoracion]",g);f()},f=function(k,j){if($.fn.select2&&$("select[data-action=select-to-select2]").length>0){$("select[data-action=select-to-select2]").select2({no_results_text:"Sin resultados para"})}},d=function(k,j){k.preventDefault();if(j!=undefined&&j.success==true){if(j.html!=undefined){$("#"+$(this).attr("data-target")).html(j.html).slideDown();notificaciones.badgeUpdate(j)}else{browser.redirect($(this).attr("data-url-reload"))}}},e=function(k,j){k.preventDefault();if(j.html!=undefined){$("#"+$(this).attr("data-target")).html(j.html).slideDown();notificaciones.badgeUpdate(j)}else{browser.redirect($(this).attr("data-url-reload"))}},a=function(j){j.preventDefault();$.when($("#contactar").slideDown()).done(function(){var k=$(this).find("form input").first();if(k.val()!=""){$(this).find("form textarea").focus()}else{k.focus()}});f()},c=function(k,j){k.preventDefault();$("#valoracion_tab").click()},b=function(){var k=$("input[type=radio]:checked");var j=$("#p_receptor");$("select[name=p_elemento]").attr("data-tipo",k.val());var l="tipo="+k.val();l+="&usuario="+j.val();$.ajax({url:k.attr("data-url"),type:"post",data:l,dataType:"json",async:true,success:function(m){if(m.html){$("select[name=p_elemento]").html(m.html)}}})},h=function(k,j){browser.rediret(j.url)},g=function(k,j){if(j.reason=="invitar-red"){$.when(alerts.showConfirm(j.message)).done(function(){$("a[data-action=invitar-red]").click()})}else{alerts.showAlert(j.message)}};return{init:i}})();var navegacion=(function(){var d;var c=function(){d=false;$("body").on("click","a[data-action*=configurar-listado]",a);$("div[data-name=navegacion] a[href=#]").unbind("click");$("body").on("click","div[data-name=navegacion] a[href=#]",b)},b=function(){boton=$(this);if(boton){boton.find("span").hide();boton.find("img").show()}if(!d){d=true;var e=boton.parent().parent();var f="id="+e.attr("data-id");f+="&type="+e.attr("data-type");if(e.attr("data-key")){f+="&key="+e.attr("data-key")}$.ajax({url:e.attr("data-url"),type:"post",data:f,dataType:"json",async:true,success:function(g){d=false;if(boton){boton.find("img").hide();boton.find("span").show()}if(g&&boton){e=$(g);if(boton.attr("data-name")=="siguiente"&&e.find("a[data-name=siguiente][href!=#]").length){location.href=e.find("a[data-name=siguiente][href!=#]").attr("href")}else{if(boton.attr("data-name")=="anterior"&&e.find("a[data-name=anterior][href!=#]").length){location.href=e.find("a[data-name=anterior][href!=#]").attr("href")}}}},error:function(g){d=false;if(boton){boton.find("img").hide();boton.find("span").show()}}})}return false},a=function(e){e.preventDefault();obj=$(this);$.when(ajax.post($(this))).done(function(f){if(f!=undefined&&f.success==true){browser.redirect(obj.attr("href"))}})};return{init:c}})();$(document).ready(function(){observer.init();vista.init();alerts.init();boton.init();buscador.init();menuUsuario.init();subirFicheros.init();formulario.init();validations.init();habilidades.init();widgets.init();notificaciones.init();modalColectivos.init();etiquetaVATID.init();valoraciones.init();navegacion.init();foto.init()});$(window).load(function(){browser.processFragment()});window.onbeforeunload=function(a){if(preventUnload){return $("html").attr("lang")=="pt"?"Você fez modificações que não foram salvas. Se continuar, perderá o trabalho realizado.":"Tienes cambios sin guardar. Si continúas perderás el trabajo realizado."}};var candidatos=(function(){var f=function(){var h=$("[data-action=boletin-options] input[type=checkbox]");h.on("click",d);h.on("change",g);$("body").on("confirm","[data-action=radio-change]",e);$("body").on("change","[data-action=radio-change]",a);var i=$("#formCrearAlerta");i.on("submit",formulario.sendForm);i.on("success",c);$("body").on("click","a[data-action=borrar-alerta]",ajax.postConfirm);$("body").on("confirm","a[data-action=borrar-alerta]",b)},d=function(h){var i=$(this);if($(this).attr("data-message")){h.preventDefault();alerts.showAlert(i.attr("data-message"))}},g=function(h){var i=$(this);$.when(ajax.post(i)).done(function(j){boton.setAttributes(i,j.attributes)})},e=function(h){$.when(ajax.post(h)).done(function(i){if(i!=undefined&&i.success==true){if(h.closest(".btn-group").find(".btn-success").length){h.closest(".btn-group").find(".btn-success").removeClass("btn-success active").addClass("btn-w");h.parent("label").removeClass("btn-w").addClass("btn-danger")}else{h.closest(".btn-group").find(".btn-danger").removeClass("btn-danger active").addClass("btn-w");h.parent("label").removeClass("btn-w").addClass("btn-success")}}else{h.closest(".btn-group").find("label:not([class*=active])").addClass("active");h.parent("label").removeClass("active");alerts.showAlert(i.message)}})},a=function(h){var i=$(this);if(!i.parent("label").hasClass("active")){if(i.attr("data-message")){h.preventDefault();$.when(alerts.showConfirm(i.attr("data-message"))).done(function(){e(i)}).fail(function(){i.closest(".btn-group").find("label:not([class*=active])").addClass("active");i.parent("label").removeClass("active")})}else{e(i)}}},c=function(i,h){i.preventDefault();if(h!=undefined&&h.success==true){$("#"+$(this).attr("data-target")).html(h.html).slideDown();$(this)[0].reset()}},b=function(i,h){i.preventDefault();if(h!=undefined&&h.success==true){$("#"+$(this).attr("data-target")).html(h.html).slideDown()}};return{init:f}})();$(document).ready(function(){candidatos.init()});var contacto=(function(){var d=function(){var h=$("#frmContacto #p_id_tipo_consulta");h.on("change",a);var f=$("[data-action=regenerar-captcha]");f.on("click",e);var g=$("#frmContacto");g.on("submit",formulario.sendForm);g.on("success",b);g.on("error",frmContactoError);var i=$("[data-action=publicidad]");i.on("click",c)},a=function(f){if($(this).val()=="PUB"){$("#datosAnunciante ").slideDown()}else{$("#datosAnunciante ").slideUp()}$("#p_tipo_consulta").val($("option:selected",this).text())},e=function(f){f.preventDefault();$.when(ajax.post($(this))).done(function(g){frmContactoError(f,g)})},c=function(f){f.preventDefault();$("#myTab").find("a[href=#contacto]").click();$("#aviso-publicidad").removeClass("hide").addClass("in");$("#p_id_tipo_consulta").val("PUB").change()},b=function(g,f){formulario.showMessageLayer($(this),f.message,true);$("#formContent").hide()};frmContactoError=function(g,f){g.preventDefault();$("#captcha").html(f.img);$("#p_captcha_id").val(f.id);$("#p_captcha").val("")};return{init:d}})();$(document).ready(function(){contacto.init()});var curso=(function(){var b=function(){var c=$("#formCursoInscripcion");c.on("submit",formulario.sendForm);c.on("success",a)},a=function(){$(this).hide()};return{init:b}})();$(document).ready(function(){curso.init()});var facturacion=(function(){var b=function(){var h=$("[data-action=mostrar-alerta]");h.on("click",alerts.dispatchAlert);var i=$("[data-action=mostrar-confirmacion]");i.on("click",alerts.dispatchConfirm);i.on("confirm",boton.sendRequest);i.on("success",mostrarConfirmacionSuccess);var f=$("#formEditarEmpresa");f.on("submit",formulario.sendForm);var c=$("#formFacturacionPago");c.on("submit",formulario.sendForm);var e=$("[data-action=borrar-medio-de-pago]");e.on("click",borrarMedioDePagoClick);var g=$("#formEditarMedioDePago");g.on("submit",formulario.sendForm);g.on("success",formEditarMedioDePagoDone);g.on("error",formEditarMedioDePagoDone);$("body").on("click","[name=mediopagoOptions]",function(){var k=$(this).attr("data-method");$("#p_payment_method").val(k);$("#formErrorLayer").hide()});$("body").on("change","#mis-cccs",function(){if($(this).val()=="0"){var k=$("#cccCuenta").closest(".form-group");k.removeClass("hide");var l=$("#cccTitular").closest(".form-group");l.removeClass("hide")}else{var k=$("#cccCuenta").closest(".form-group");k.addClass("hide");var l=$("#cccTitular").closest(".form-group");l.addClass("hide")}});$("body").on("change","#mis-tarjetas",function(){if($(this).val()=="0"){var m=$("#p_cardnumber").closest(".form-group");m.removeClass("hide");var k=$("#p_ownercard").closest(".form-group");k.removeClass("hide");var n=$("#p_month").closest(".form-group");n.removeClass("hide");var l=$("#p_year").closest(".form-group");l.removeClass("hide");$("#p_ownercard").val("");$("#p_month option:first").prop("selected",true);$("#p_year option:first").prop("selected",true)}else{var m=$("#p_cardnumber").closest(".form-group");m.addClass("hide");var k=$("#p_ownercard").closest(".form-group");k.addClass("hide");a()}});if($("#mis-tarjetas").length>0){a()}$('li[data-toggle="tab"]').on("shown.bs.tab",function(k){$("li.btn-primary").removeClass("btn-primary");$(this).addClass("btn-primary")});$("body").on("click","[data-action=contratar-plan]",contratar);generarFactura();var j=$("#formComprobarPassword");j.on("submit",formulario.sendForm);var d=$("#formConfirmarPaypal");d.on("submit",formulario.sendForm)},a=function(){var c="";var f="";var e="";if($("#mis-tarjetas option:selected").val()!=0){c=$("#mis-tarjetas option:selected").attr("data-titular");tarjeta_fec=$("#mis-tarjetas option:selected").attr("data-fec").split("/");f=tarjeta_fec[1];e=tarjeta_fec[2].substr(2,2);caducada=$("#mis-tarjetas option:selected").attr("data-cad");if(caducada=="true"){var g=$("#p_month").closest(".form-group");g.removeClass("hide");var d=$("#p_year").closest(".form-group");d.removeClass("hide")}else{var g=$("#p_month").closest(".form-group");g.addClass("hide");var d=$("#p_year").closest(".form-group");d.addClass("hide")}}$("#p_cardnumber").closest(".form-group").addClass("hide");$("#p_ownercard").closest(".form-group").addClass("hide");$("#p_ownercard").val(c);$("#p_month").val(f);$("#p_year").val(e)};showLoading=function(){var c=$("body").find("span[class=spinnerLoading]").clone().show();$boton.append(c);$boton.attr("disabled",true)},contratar=function(c){var d=$(this);$boton=$(this);c.preventDefault();showLoading();if(d.attr("data-tipo-compra")==="RENOVAR"&&$("#renovacion-current-sp").val()==="1"){$("#container-info-compra").html("<p>"+$("#msg-info-unnecessary").val()).show();goToByScroll("container-info-compra")}else{if(d.attr("data-tipo-compra")==="BLOQUEO"){$("#container-info-compra").html("<p>"+$("#msg-info-bloqueo").val()).show();goToByScroll("container-info-compra")}else{window.location.href=d.attr("href")}}return false},mostrarConfirmacionSuccess=function(d,c){browser.redirect($(this).attr("data-url-redirect"))},generarFactura=function(){if($("#generar-factura").length>0){urldownload=$("#generar-factura").attr("data-url-download");msgdownload=$("#generar-factura").attr("data-msg-download");$.when(ajax.post($("#generar-factura"))).done(function(c){$("#capa-loading").hide();data='<a href="'+urldownload+'" class="btn btn-info btn-lg btn-block"><span class="glyphicon glyphicon-eye-open"></span> '+msgdownload+"</a>";$("#generar-factura").html(data)})}},borrarMedioDePagoClick=function(c){c.preventDefault();var d=$(this);if($(this).attr("data-message")){$.when(alerts.showConfirm(d.attr("data-message"))).done(function(){$.when(ajax.post(d)).done(function(e){browser.reload()})})}else{$.when(ajax.post(d)).done(function(e){browser.reload()})}},formEditarMedioDePagoDone=function(d,c){d.preventDefault();if(c!=undefined){formulario.showMessageLayer($(this),c.message,c.success)}};return{init:b}})();$(document).ready(function(){facturacion.init()});var gestion=(function(){var j;var d=$.Deferred();var h=function(){var s=$("#formInscripcionOferta");s.on("submit",formulario.sendForm);s.on("success",c);var q=$("#formPropuestaProyecto");q.on("submit",formulario.sendForm);q.on("success",f);var m=$("#formSolicitudServicio");m.on("submit",formulario.sendForm);m.on("success",e);var k=$("#formEditarOferta");var o=$("#formEditarProyecto");var p=$("#formEditarServicio");if(k.length||o.length||p.length){formulario.setFormCoordinates()}k.on("submit",formulario.sendForm);o.on("submit",formulario.sendForm);p.on("submit",formulario.sendForm);$("body").on("click","[data-action=load-tab-content]",resetFilters);$("body").on("click","#botonMostrarFiltros",changeFiltersButton);var n=$("#formFiltros");n.on("show",setEstadoFilter);n.on("submit",setDataParams);n.on("submit",vista.loadTabContent);n.on("success",formFiltrosSuccess);var r=$("#formFiltros #p_fk_id_publicador");r.on("change",mostrarUsuariosPublicador);$("body").on("click","[data-action=cargar-select-lote]",cargarSelect);$("body").on("change","#p_acciones_listado",comprobarConfirmacion);$("body").on("click","#tabla_anuncios tr",selectRow);$("body").on("click","[data-action=aplicar-acciones-lote]",aplicarAccionesLote);$("body").on("confirmed","[data-action=aplicar-acciones-lote]",boton.sendRequest);$("body").on("success","[data-action=aplicar-acciones-lote]",cambiarEstadoAnuncioSuccess);$("body").on("error","[data-action=aplicar-acciones-lote]",cambiarEstadoAnuncioError);$("body").on("click","[data-action=cambiar-estado-anuncio]",cambiarEstadoAnuncio);$("body").on("confirmed","[data-action=cambiar-estado-anuncio]",boton.sendRequest);$("body").on("success","[data-action=cambiar-estado-anuncio]",cambiarEstadoAnuncioSuccess);$("body").on("error","[data-action=cambiar-estado-anuncio]",cambiarEstadoAnuncioError);$("body").on("click","#p_estado_listado li",seleccionarAccionesEnLote);$("body").on("click","[data-action=avisar-no-contratado]",alerts.dispatchAlert);observer.subscribe("gestion",actualizarContador);$("body").on("change","[data-action=publicar-como]",marcarCiego);$("body").on("change","[data-action=cambiar-logo-subcategoria]",cambioCategoria);$("body").on("hover","[data-action=verEn]",toggleVerEn);var l=$("[data-action=ir-oferta-externa]");l.on("click",a);$("body").on("click","[data-action=form-storage]",i);$("#formEditarProyecto").find("#p_nombre").on("focusout",g);$("#formEditarProyecto").find("#p_descripcion").on("focusout",g);$("#formEditarServicio").find("#p_nombre").on("focusout",g);$("#formEditarServicio").find("#p_descripcion").on("focusout",g);$("#formEditarOferta").find("#p_nombre").on("focusout",g);$("#formEditarOferta").find("#p_descripcion").on("focusout",g)},g=function(){var k=$(this).val();var p=$("#p_fk_id_dominio_colectivo").val();var n=$("#p_id_oferta").val();var l=$("#p_id_proyecto").val();var q=$("#p_id_servicio").val();if(k&&p&&!n&&!l&&!q){var m=$(this).attr("data-url");var o="texto="+encodeURIComponent(k)+"&id_colectivo="+p;$.ajax({url:m,type:"post",data:o,dataType:"json",async:true,success:function(r){var u=$("#p_habilidad").val();habs_actuales_array=u.split(",");for(var s in r){if(habs_actuales_array.indexOf(r[s])==-1){var t=(u)?",":"";u=u+t+r[s];$(".typeaheadContent").append('<span class="label label-default">'+r[s]+'<a data-action="borrarHabilidad" href="#"><span class="glyphicon glyphicon-trash"></span></a></span>')}}$("#p_habilidad").val(u)}})}},i=function(m){m.preventDefault();var n=$("form").serializeArray();var l=$("#sk").val();sessionStorage.setItem(l,JSON.stringify(n));var k=$(this).attr("data-url");browser.redirect(k)},b=function(k){var k=$("#sk").val();var l=sessionStorage.getItem(k);l=JSON.parse(l);if(l){l.forEach(function(n){var p=n.value;var o=$('[name="'+n.name+'"]');if(o.is("textarea")){o.html(p)}else{if(o.is("select")){o.children('option[value="'+p+'"]').prop("selected",true)}else{o.attr("value",p)}}if(n.name=="p_permite_teletrabajo"){if(p=="1"){$("#p_permite_teletrabajo_no").attr("checked","");$("#p_permite_teletrabajo_si").attr("checked","checked")}}if(n.name=="p_fk_id_pais"){if(p!=""){$("#label_pais").parent("div.hide").removeClass("hide")}}if(n.name=="p_habilidad"){var m=p.split(",");m.forEach(function(r){var q='<span class="label label-default ">';q=q+r;q=q+'<a data-action="borrarHabilidad" href="#"><span class="glyphicon glyphicon-trash"></span></a></span>';$("div.typeaheadContent").append(q)})}if(n.name=="p_fk_id_dominio_colectivo"){o.trigger("change")}})}},a=function(k){browser.redirect($(this).attr("data-url"))},c=function(m,l){$(this).hide();if(l.data.oferta_externa){$("#inscripcion-externa").show()}else{if(l.data.show_cursos){$("#inscripcion-titulo, #oferta-titulo").hide();var k=$("#track-cursos-oferta").attr("data-src");$("#track-cursos-oferta").attr("src",k);$("#inscripcion-titulo-show-cursos, #oferta-titulo-show-cursos, #inscripcion-show-cursos").show()}else{$("#inscripcion-vip").show()}}},f=function(){$(this).hide();$("#propuesta-vip").show()},e=function(){$(this).hide();$("#solicitud-like").show()};actualizarContador=function(l,k){$("#"+l).html(k)},cambiarEstadoAnuncio=function(k){k.preventDefault();var l=$(this);if(l.attr("data-confirm")!==undefined&&l.attr("data-confirm")=="true"){$.when(alerts.showConfirm(l.attr("data-message"))).done(function(){l.trigger("confirmed")})}else{l.trigger("confirmed")}},cambiarEstadoAnuncioSuccess=function(l,k){if(k.contadores){$.each(k.contadores,function(m,n){observer.publish("gestion","contador_"+m,n)})}desactivarAccionesEnLote();$("#formFiltros").submit()},cambiarEstadoAnuncioError=function(l,k){l.preventDefault();cambiarEstadoAnuncioSuccess(l,k);if(k.errorId!=undefined){$("#p_acciones_listado").data("errorId",k.errorId);$.when(d).done(function(){formulario.showGlobalMessageLayer(k.message,"warning")})}else{alerts.showAlert(k.message)}},formFiltrosSuccess=function(k){if($("#p_acciones_listado").data().errorId!=undefined){$.each($("#p_acciones_listado").data().errorId,function(l,m){$("[data-id='"+m+"']").click()});$("#p_acciones_listado").removeData("errorId");d.resolve()}},selectRow=function(l){var k=$(l.target);if(k.is("tr")||k.is("td")||(k.is("input")&&k.type=="checkbox")){$(this).find("td").first().find("input[type=checkbox]").click()}},aplicarAccionesLote=function(m){m.preventDefault();var p=$(this);var k=$(":checkbox:checked");var l=new Array();k.each(function(){if($(this).attr("data-value")!==undefined){var q={id:$(this).attr("data-id"),estado:$(this).attr("data-value")}}else{var q={id:$(this).attr("data-id")}}l.push(q)});var o={p_estado:$("#p_acciones_listado").val(),p_datos:l};p.attr("data-params",JSON.stringify(o));var n=$("#p_acciones_listado option:selected");if(n.attr("data-confirm")!==undefined&&n.attr("data-confirm")=="true"){$.when(alerts.showConfirm(n.attr("data-message"))).done(function(){p.trigger("confirmed")})}else{p.trigger("confirmed")}},comprobarConfirmacion=function(){var l=$(this).find("option:selected"),k=$(this).parent().find(".btn");if(!l.val().length){k.attr("disabled","disabled").addClass("disabled")}else{k.removeAttr("disabled").removeClass("disabled")}},cargarSelect=function(){var n=$(this).attr("data-target");if($(":checkbox:checked").length){var m=new Array(),l=0,p=0,k=0,o=0;$(":checkbox:checked").each(function(){var q=$.parseJSON($(this).attr("data-value"));$.each(q,function(r,s){if($.inArray(s,m)===-1){m.push(s)}})});$("#"+n).empty();$("#baseAccionesLote option").clone().appendTo($("#"+n));$.each(m,function(q,r){$("#"+n+" option").each(function(){var s=($(this).attr("data-value"))?$.parseJSON($(this).attr("data-value")):{};if($.inArray(r,s)!=-1){$(this).remove()}})})}if($(":checkbox:not(:checked)").length==$(":checkbox").length){$("#boton_listado").find(".cuadro").html("");desactivarAccionesEnLote()}else{if($(":checkbox:checked").length==$(":checkbox").length){$("#boton_listado").find(".cuadro").html('<span class="glyphicon glyphicon-ok"></span>');activarAccionesEnLote()}else{if($(":checkbox:checked").length<$(":checkbox").length){$("#boton_listado").find(".cuadro").html('<span class="glyphicon glyphicon-minus"></span>');activarAccionesEnLote()}}}},seleccionarAccionesEnLote=function(l){l.preventDefault();var k=$(this).attr("data-value");$("input:checkbox").prop("checked",false);desactivarAccionesEnLote();if(k=="N"){$("#boton_listado").find(".cuadro").html("")}else{if(k=="T"){$("input:checkbox").click();$("#boton_listado").find(".cuadro").html('<span class="glyphicon glyphicon-ok"></span>');activarAccionesEnLote()}else{$("input[data-value^='[\""+k+"']").click();if($(":checkbox:checked").length){$("#boton_listado").find(".cuadro").html('<span class="glyphicon glyphicon-minus"></span>')}else{$("#boton_listado").find(".cuadro").html("")}}}},activarAccionesEnLote=function(){$("#p_acciones_listado").removeAttr("disabled").removeClass("disabled")},desactivarAccionesEnLote=function(){$("#p_acciones_listado option").removeAttr("selected").find(":first").attr("selected","selected");$("#p_acciones_listado").attr("disabled","disabled").addClass("disabled").parent().find(".btn").attr("disabled","disabled").addClass("disabled")},setDataParams=function(k){$("#botonMostrarFiltros").attr("data-params",JSON.stringify(utils.serializeObject($(this).closest("form"))))},changeFiltersButton=function(l){l.preventDefault();var m=$(this);var k=m.find(".glyphicon");if(k.hasClass("glyphicon-eye-open")){k.removeClass("glyphicon-eye-open").addClass("glyphicon-eye-close");m.find(".label-mostrar").hide();m.find(".label-ocultar").show();m.attr("data-action","hide-form")}else{if(k.hasClass("glyphicon-eye-close")){k.removeClass("glyphicon-eye-close").addClass("glyphicon-eye-open");m.find(".label-ocultar").hide();m.find(".label-mostrar").show();m.attr("data-action","show-form")}}},resetFilters=function(m){m.preventDefault();var l=$("#botonMostrarFiltros");var n=typeof $(this).attr("data-params")!="undefined"?$(this).attr("data-params"):"{}";l.attr("data-params",n);if(l.find(".glyphicon").hasClass("glyphicon-eye-close")){l.click()}var k=$("#formFiltros").trigger("reset");formulario.hideFormulario(k);$("#formFiltros").attr("action",$(this).attr("data-url"));desactivarAccionesEnLote();$("#aplicarAcionesLote").attr("data-url-redirect",$(this).attr("data-url"))},setEstadoFilter=function(k){k.preventDefault();if($(this).find("#p_estado_2").val()=="R"){$(this).find("#p_estado").attr("disabled",true).closest(".btn-group").addClass("hide")}else{$(this).find("#p_estado").attr("disabled",false).closest(".btn-group").removeClass("hide")}},mostrarUsuariosPublicador=function(){var l=$(this);$("#p_fk_id_usuario_filtro option").each(function(m){if(m!=0){$(this).remove()}});$("#p_fk_id_usuario_filtro").attr("disabled","disabled");if(l.val()!=""){var k=l.attr("data-url")+"/"+l.val();$.ajax({url:k,type:"get",dataType:"json",async:true,success:function(m){if(m!=undefined&&m.success==true){if(m.usuarios.length>0){for(var n=0;n<m.usuarios.length;n++){$("#p_fk_id_usuario_filtro").append('<option value="'+m.usuarios[n].idUsuario+'">'+m.usuarios[n].nombre+"</option>")}$("#p_fk_id_usuario_filtro").removeAttr("disabled")}}}})}return false},marcarCiego=function(){var l=$(this);var k=l.find("option:selected");if(k.attr("data-ciego")=="true"){$("#publicar_como").prop("disabled","disabled");$("#publicar_como_ciego").removeClass("hide");$("#p_nombre_publicador").focus();$("#p_nombre_publicador").val("");$("#p_anuncio_ciego").val(1)}else{$("#publicar_como").prop("disabled",false);$("#publicar_como_ciego").addClass("hide");$("#p_anuncio_ciego").val(0)}},cambioCategoria=function(){cambiarLogoSubcategoria($(this));habilidades.refrescarAutocompletar();$("#formEditarProyecto").find("#p_nombre").trigger("focusout");$("#formEditarProyecto").find("#p_descripcion").trigger("focusout");$("#formEditarServicio").find("#p_nombre").trigger("focusout");$("#formEditarServicio").find("#p_descripcion").trigger("focusout");$("#formEditarOferta").find("#p_nombre").trigger("focusout");$("#formEditarOferta").find("#p_descripcion").trigger("focusout")},cambiarLogoSubcategoria=function(m){var k=m.attr("data-url");var l={dominio:m.val()};$.ajax({url:k,type:"post",dataType:"json",data:l,async:true,success:function(n){if(n.success){$("#logo_subcategoria").html(n.image)}else{$("#logo_subcategoria").html("")}}})},toggleVerEn=function(k){k.preventDefault();if($("#verEn").stop().attr("display","none")){$("#verEn").show()}else{$("#verEn").hide()}};return{init:h,recoverForm:b}})();var killerquestions=(function(){var a=function(){if($("#has_oferta_solicitudes").length==0){$("body").on("click","[data-action=add-killer-question]",addKillerQuestion);$("body").on("click","[data-action=answer-type] input",answerType);$("body").on("click","[data-action=quitar-killer-question]",borrarKq)}};addKillerQuestion=function(){if($("#has_oferta_solicitudes").length==0){if($(".kq").length<$("#kq_max").val()){var b=$(".kq").length+1;var c=$(this).attr("data-url");getKillerQuestion(c,b)}}},getKillerQuestion=function(c,b){var d={kq_index:b,p_uniqid:$("#uniqid").val()};$.ajax({url:c,type:"post",dataType:"html",data:d,async:true,success:function(e){$(e).appendTo("#kq").slideDown();if($(".kq").length==$("#kq_max").val()){$("[data-action=add-killer-question]").hide()}}});return false},answerType=function(b){if($(this).val()==1){$(this).closest(".kq").find(".kq-answers").slideDown()}else{$(this).closest(".kq").find(".kq-answers").slideUp()}},borrarKq=function(b){b.preventDefault();$(this).closest(".kq").remove();$("[data-action=add-killer-question]").show();resortKq()},resortKq=function(){$(".kq").each(function(c){var b=c+1;$('[name^="kq_"]',this).each(function(e){var f=$(this).attr("name");var d=/(kq_\[)\d+(\].+)/;var f=f.replace(d,"$1"+b+"$2");$(this).attr("name",f)})})};return{init:a}})();$(document).ready(function(){gestion.init();killerquestions.init()});$(window).load(function(){gestion.recoverForm()});var mensaje=(function(){var k=function(){var l=$("#btnInvitacion");l.on("click",i);var m=$("#formInvitar");m.on("submit",formulario.sendForm);m.on("success",e);m.on("error",e);$("body").on("submit","#formEnviarMensaje",formulario.sendForm);$("body").on("success","#formEnviarMensaje",d);$("body").on("show","#contactar",function(){if($.fn.select2&&$("select[data-action=select-to-select2]").length>0){$("select[data-action=select-to-select2]").select2({no_results_text:"Sin resultados para"})}});$("body").on("submit","#formResponderMensaje",formulario.sendForm);$("body").on("success","#formResponderMensaje",c);$("body").on("click","a[data-action=cambiar-bandeja]",vista.loadTabContent);$("body").on("success","a[data-action=cambiar-bandeja]",b);$("body").on("click","a[data-action=aceptar-cancelar-solicitud]",g);$("body").on("click","a[data-action=eliminar-mensaje]",ajax.postConfirm);$("body").on("confirm","a[data-action=eliminar-mensaje]",a);observer.subscribe("contadores-buzon",f);if($(".scroll2").length>0){$("html, body").animate({scrollTop:($(".scroll2").offset().top-($(window).height()/2))},600)}$("body").on("click","[data-action=redactar-mensaje]",h);$("body").on("click","[data-action=cerrar-mensaje]",j)},j=function(l){l.preventDefault();$("#contactar").slideUp()},h=function(l){l.preventDefault();$.when($("#contactar").slideDown()).done(function(){var m=$(this).find("form input").first();if(m.val()!=""){$(this).find("form textarea").focus()}else{m.focus()}});if($.fn.select2&&$("select[data-action=select-to-select2]").length>0){$("select[data-action=select-to-select2]").select2({no_results_text:"Sin resultados para"})}},i=function(n,m){radioVal=$("[name='p_id_tipo_relacion']:radio:checked").val();if(radioVal=="6"||radioVal=="NOC"){$(this).attr("disabled","disabled");var l=$("#btnVolver").attr("href");$.when(alerts.showConfirm($(this).attr("data-message-cannot"))).done(function(){browser.redirect(l+"#!contactar-profesional")}).fail(function(){browser.redirect(l)})}else{$("#formInvitar").trigger("submit")}},e=function(m,l){if(l.success){formulario.showMessageLayer($(this),l.message,true)}if(typeof l.errors=="undefined"){$(this).find("#bodyMensajeInvitar").hide();$(this).find("#btnInvitacion").hide();$(this).find("#btnVolver").removeClass("hide")}},d=function(m,l){m.preventDefault();formulario.hideFormulario($(this));if(typeof l.urlReload!="undefined"){browser.redirect(l.urlReload)}else{browser.reload()}},c=function(m,l){m.preventDefault();formulario.hideFormulario($(this));if(browser.hasFragment()){browser.redirect($(".enc a").attr("href"))}else{if(typeof l.urlReload!="undefined"){ajax.loadLayer(l.urlReload,"mensaje")}}},b=function(n,m){n.preventDefault();$("a[data-action=cambiar-bandeja]").removeClass("active");$(this).addClass("active");var l=$(this).attr("data-params");if(l!=undefined){data=$.parseJSON(l);if(data.bandeja=="valoracion"){notificaciones.notificar()}}},g=function(l){l.preventDefault();$.when(ajax.post($(this))).done(function(m){browser.redirect(m.url)})},a=function(m,l){m.preventDefault();browser.redirect($(this).attr("data-url-reload"))},f=function(l){$("#total-mensajes-pendientes").html(l)};return{init:k}})();$(document).ready(function(){mensaje.init()});var publicador=(function(){var h=function(){var n=$("#formCrearPublicador");n.on("submit",formulario.sendForm);n.on("success",browser.reload);var k=$("a[data-action=btnBorrarLogo]");k.on("click",ajax.postConfirm);k.on("confirm",a);var p=$("#fileupload_logo_sitio");p.on("uploaded",e);p.on("noUploaded",b);var l=$("a[data-action=btnBorrarLogoSitio]");l.on("click",ajax.postConfirm);l.on("confirm",d);observer.subscribe("nombre-publicador-facturacion",c);n.find("#p_nombre_publicador").on("change",function(){observer.publish("nombre-publicador-facturacion",$(this).val())});$("body").on("click","a[data-action=confirmar-borrar-usuario]",ajax.postConfirm);$("body").on("confirm","a[data-action=confirmar-borrar-usuario]",f);var j=$("#formCrearUsuario");j.on("submit",formulario.sendForm);j.on("success",i);var m=$("#formEditarMsgInscripcion");m.on("submit",formulario.sendForm);m.on("success",g);var o=$("a[data-action=borrar-mensaje-inscripcion]");o.on("click",boton.sendRequest);o.on("success",function(){$("#p_mensaje").val("")});o.on("success",g)},c=function(j){$("#formCrearPublicador").find("#p_fac_nombre_empresa").val(j)},b=function(k,j){$("#fotoErrorLayer").html(j.message).slideDown()},a=function(k,j){if(j!=undefined&&j.success==true){$("#p_tiene_logo").val("0");$("#borrar_logo").addClass("hide");$("#publicador_logo").html(j.imagen)}},e=function(k,j){$("#p_tiene_logo_sitio").val("1");$("#borrar_logo_sitio").removeClass("hide");$("#fotoErrorLayer").hide()},d=function(k,j){if(j!=undefined&&j.success==true){$("#p_tiene_logo_sitio").val("0");$("#borrar_logo_sitio").addClass("hide");$("#publicador_logo_sitio").html(j.imagen)}},f=function(k,j){k.preventDefault();if(j.success){if(j!=undefined&&j.url!=undefined){browser.redirect(j.url)}else{ajax.loadLayer($(this).attr("data-url-reload"),$(this).attr("data-target"))}}else{if($(this).attr("data-error")&&j.message){$("#"+$(this).attr("data-error")).html(j.message);$("#"+$(this).attr("data-error")).show()}}},i=function(k,j){k.preventDefault();ajax.loadLayer($(this).attr("data-url-reload"),$(this).attr("data-target"))},g=function(k,j){k.preventDefault();formulario.showMessageLayer($(this),j.message,true)};return{init:h}})();$(document).ready(function(){publicador.init()});var usuario=(function(){var al=function(){var a0=$("#formPaso1");if(a0.length){formulario.setFormCoordinates()}a0.on("submit",formulario.sendForm);a0.on("success",X);var ax=$("#formRecPassword");ax.on("submit",formulario.sendForm);ax.on("success",ap);var aI=$("#formRecPassword2");aI.on("submit",formulario.sendForm);aI.on("success",browser.reload);var aQ=$("#btnGenerarPassword");aQ.on("click",boton.sendRequest);aQ.on("success",aa);aQ.on("error",h);var a6=$("#btnSeguir");a6.on("click",boton.sendRequest);a6.on("success",ak);a6.on("error",l);var au=$("a[data-action=btnPdf]");au.on("click",boton.sendRequest);au.on("error",aq);var bc=$("a[data-action=btnFavorito]");bc.on("click",boton.sendRequest);var az=$("a[data-action=btnComentar]");az.on("click",g);var aG=$("a[data-action=btnOcultarComentar]");aG.on("click",Y);var aY=$("#frmProfesionalComentario");aY.on("submit",formulario.sendForm);aY.on("success",an);$("body").on("click","a[data-action=invitar-red]",boton.sendRequest);$("body").on("error","a[data-action=invitar-red]",G);$("body").on("click","a[data-action=eliminar-red]",ajax.postConfirm);$("body").on("confirm","a[data-action=eliminar-red]",R);if($("#popover-login").length>0){var aZ=$("#popover-login");aZ.popover({animation:true,html:true,content:$("#popover-content").html(),container:"#user-switcher"});aZ.popover("show");$(".arrow").attr("style","left:92%");ajax.post(aZ);var a3=$("#close-login-popover");a3.on("click",function(){aZ.popover("hide")});var a7=$("#ok-login-popover");a7.on("click",function(){aZ.popover("hide");ajax.post($(this))});var ba=$("#user-switcher-button");ba.on("click",function(){$(".popover").remove()})}if($("#promoSitiosModal").length>0){var av=$("#promoSitiosModal");av.modal();ajax.post(av)}var aF=$("#fileupload_cv");aF.on("uploaded",ab);aF.on("noUploaded",L);var a4=$("a[data-action=btnBorrarCv]");a4.on("click",ajax.postConfirm);a4.on("confirm",ag);var aO=$("a[data-action=saltarPaso2]");aO.on("click",alerts.dispatchConfirm);aO.on("confirm",J);$("body").on("click","a[data-action=cambiar-privacidad]",M);$("body").on("click","a[data-action=cambiar-privacidad-confirm]",ajax.postConfirm);$("body").on("confirm","a[data-action=cambiar-privacidad-confirm]",P);observer.subscribe("seguidores-publicador",am);var a8=$("#botonContactarProfesional");a8.on("click",boton.sendRequest);a8.on("success",I);a8.on("error",G);var aK=$("#botonComprarPerfil");aK.on("click",boton.sendRequest);aK.on("success",E);aK.on("error",D);var at=$("[data-action=cambiar-estado-propuesta]");at.on("click",boton.sendRequest);at.on("success",B);var aE=$("#formEditarDatosPersonales");aE.on("submit",formulario.sendForm);aE.on("success",af);var aB=$("#editarUrl");aB.on("click",d);$("#formEditarDatosPersonales #p_permalink").keyup(function(bg){if(bg.which==13){bg.preventDefault()}$("#formEditarDatosPersonales #editarUrl").html(utils.permalink($("#formEditarDatosPersonales #p_permalink").val()))});var bf=$("#formEditarExperiencia");bf.on("submit",formulario.sendForm);bf.on("success",af);$("body").on("click","[data-action=borrar-experiencia]",ajax.postConfirm);$("body").on("confirm","[data-action=borrar-experiencia]",aj);$("body").on("change","[data-action=mostrar-finalizacion]",ar);var be=$("#formEditarFormacion");be.on("submit",formulario.sendForm);be.on("success",af);$("body").on("click","[data-action=borrar-formacion]",ajax.postConfirm);$("body").on("confirm","[data-action=borrar-formacion]",aj);$("body").on("click","[data-action=marcarPrincipal]",V);var a9=$("#formEditarHabilidades");a9.on("show",habilidades.loadEtiquetas);a9.on("submit",ai);a9.on("submit",formulario.sendForm);a9.on("success",af);var aP=$("#formEditarIdioma");aP.on("submit",formulario.sendForm);aP.on("success",af);$("body").on("click","[data-action=borrar-idioma]",ajax.postConfirm);$("body").on("confirm","[data-action=borrar-idioma]",aj);var aW=$("#formEditarDatosAdicionales");aW.on("submit",formulario.sendForm);aW.on("success",af);var aB=$("#formEditarUrl");aB.on("submit",S);aB.on("submit",formulario.sendForm);aB.on("success",af);$("body").on("click","[data-action=borrar-url]",ajax.postConfirm);$("body").on("confirm","[data-action=borrar-url]",aj);$("body").on("click","#editarPerfilPrivado",ao);$("body").on("click","#infoPerfilPrivado",ac);var aH=$("#formEditarPerfilPrivado");var ay=$("[data-action=submit-form]");ay.on("click",c);aH.on("submit",formulario.sendForm);aH.on("success",ac);aH.on("success",af);aH.on("error",j);$("body").on("change","#formEditarPerfilPrivado #p_fk_id_pais_nacionalidad",m);$("body").on("change","#formEditarPerfilPrivado",function(){preventUnload=true});var aT=$("#formInvitarEmail");aT.on("submit",formulario.sendForm);aT.on("success",o);$("#btnAceptar").on("click",boton.sendRequest);$("#btnRechazar").on("click",boton.sendRequest);$("body").on("click","a[data-action=actualizar-fecha-cv]",b);$("body").on("click","a[data-action=activar-perfil-publico-vip]",b);$("body").on("click","a[data-action=recibir-boletin]",b);var a1=$("#formConfirmarPaypal");a1.on("submit",formulario.sendForm);var aw=$("#formEnviarInvitaciones");var aV=$("#btn-frm-invitar");if($("#dest_email").length>0){$("#dest_email").tagsinput({confirmKeys:[13,188,32]});$("#dest_email").tagsinput("focus")}aV.on("click",function(){if($(".bootstrap-tagsinput input").val()!=""){if($("#dest_email").val()!=""){$("#dest_email").val($("#dest_email").val()+","+$(".bootstrap-tagsinput input").val())}else{$("#dest_email").val($(".bootstrap-tagsinput input").val())}}aw.submit()});aw.on("submit",formulario.sendForm);aw.on("success",p);aw.on("error",p);var a5=$("[data-action=editarPreferencias]");a5.on("submit",formulario.sendForm);a5.on("success",v);a5.on("error",ae);var aX=$(".preferencias [data-action=show-form]");aX.on("click",u);var bd=$("[data-action=editarPreferencias] [data-action=hide-form]");bd.on("click",O);var aR=$("[data-action=baja-usuario]");aR.on("click",x);var aD=$("[data-action=validate-email]");aD.on("click",boton.sendRequest);aD.on("success",function(bh,bg){alerts.showAlert(bg.message)});var bb=$("#formPaso1 [name=reg_email]");bb.on("focus",function(bg){if($("#fb_email").val()){msg=$(this).attr("data-message");$(this).tooltip({trigger:"manual",title:msg}).tooltip("show")}});bb.on("blur",function(bg){if($("#fb_email").val()){$(this).tooltip("destroy")}});var aA=$("#formBajaEnvios");aA.on("submit",formulario.sendForm);aA.on("success",f);var a2=$("a[data-action=invitacion-pendiente]");a2.on("click",Q);var aM=$("a[data-action=comprar-vip]");aM.on("click",N);var aN=$("[data-action=destroy-FBSession]");aN.on("click",boton.sendRequest);aN.on("success",browser.reload);var aL=$("[data-action=obtener-etiqueta-nic]");aL.on("change",t);var aS=$("[data-action=actualizar-contador-modal-sitios]");aS.on("click",A);habilidades.refrescarAutocompletar();aP.on("success",T);aE.on("success",T);bf.on("success",T);be.on("success",T);var aJ=$("[data-action=get-gmail-contacts],[data-action=get-outlook-contacts],[data-action=get-yahoo-contacts]");aJ.on("click",K);var aU=$("[data-action=get-contactos]");aU.on("click",r);var aC=$("[data-action=show-custom-contactos]");aC.on("click",w);$("body").on("submit","[data-action=enviar-invitacion],[data-action=enviar-invitacion-conocidos]",a);$("body").on("submit","[data-action=enviar-invitacion],[data-action=enviar-invitacion-conocidos]",formulario.sendForm);$("body").on("error","[data-action=enviar-invitacion],[data-action=enviar-invitacion-conocidos]",H);$("body").on("success","[data-action=enviar-invitacion]",s);$("body").on("success","[data-action=enviar-invitacion-conocidos]",ah);$("body").on("click","[data-action=saltar-paso]",ad);$("body").on("click","[data-action=saltar-fin]",F);$("body").on("click","[data-action=all-contacts]",W);$("body").on("change","[data-action=contacto-check]",k);if($("span[data-name=navegacion]").length==1){C()}},C=function(){var at="id="+$("span[data-name=navegacion]").parent().parent().attr("data-id");$.ajax({url:$("div[data-name=navegacion]").parent().attr("data-url"),type:"post",data:at,dataType:"json",async:true,success:function(au){if(au){$("span[data-name=navegacion]").html(au)}}})},X=function(au,at){_gaq.push(["_trackEvent","user","account_create"]);browser.redirect(at.url_redirect)},ap=function(au,at){formulario.showMessageLayer($("#formRecPassword"),at.message,true)},aa=function(au,at){$("#capaFormRecPassword2").hide();$("#capaRecuperarPassword").show();au.stopPropagation()},h=function(au,at){boton.showAlert(at.message)},ak=function(au,at){observer.publish("publicadores-seguidos",at.data.num_seguidos);observer.publish("seguidores-publicador",at.data.num_seguidores)},l=function(au,at){if(at.reason=="perfil_inactivo"){$.when(alerts.showConfirm(at.message)).done(function(){$.when($.get(at.confirm_url)).done(function(){$("#btnSeguir").click()})})}},am=function(av){var au=$("#capa_publicador_seguidores");var at="";if(av==1){at=au.attr("data-text-singular")}else{at=au.attr("data-text-plural");at=at.replace("%s",av)}au.html(at)},n=function(){$("#contactar").show();$.when($("#mensaje").slideDown()).done(function(){var at=$(this).find("#p_asunto");if(at.val()!=""){$(this).find("form textarea").focus()}else{at.focus()}})},I=function(au,at){n()},G=function(au,at){if(at.reason=="comprar_mensaje"){$.when(alerts.showConfirm(at.message)).done(function(){$.when($.get(at.confirm_url)).done(y)})}else{if(at.reason=="contratar_servicio"){$.when(alerts.showConfirm(at.message)).done(function(){browser.redirect(at.confirm_url)})}else{if(at.reason=="contactar_soporte"){alerts.showAlert(at.message)}else{if(at.reason=="invitar_red"){$.when(alerts.showConfirm(at.message)).done(function(){browser.redirect(at.confirm_url)})}else{if(at.reason=="crear_publicador"){$.when(alerts.showConfirm(at.message).done(function(){browser.redirect(at.confirm_url)}))}else{if(at.reason=="hay_solicitud"||at.reason=="el_mismo"){alerts.showAlert(at.message)}}}}}}},y=function(at){if(at.success){boton.setAttributes($("#botonContactarProfesional"),at.attributes);n()}else{if(at.reason=="contratar_servicio"){$.when(alerts.showConfirm(at.message)).done(function(){browser.redirect(at.confirm_url)})}}},E=function(au,at){$.when(alerts.showConfirm(at.message)).done(function(){$.when($.get(at.confirm_url)).done(browser.reload)})},D=function(au,at){if(at.reason=="contratar_servicio"){$.when(alerts.showConfirm(at.message)).done(function(){browser.redirect(at.confirm_url)})}else{if(at.reason=="contactar_soporte"||at.reason=="usar_contactar"){alerts.showAlert(at.message)}else{if(at.reason=="ya_comprado"){browser.reload()}else{if(at.reason=="crear_publicador"){$.when(alerts.showConfirm(at.message).done(function(){browser.redirect(at.confirm_url)}))}}}}},B=function(au,at){browser.redirect($(this).attr("data-url-redirect"))},aq=function(au,at){if(at.reason=="contratar_servicio"){$.when(alerts.showConfirm(at.message)).done(function(){browser.redirect(at.confirm_url)})}else{if(at.reason=="no_comprado"){$.when(alerts.showConfirm(at.message)).done(function(){$("#botonComprarPerfil").click()})}else{alerts.showAlert(at.message)}}},g=function(at){at.preventDefault();var au=$(this).attr("data-target");$("#"+au).slideDown().find("form textarea").first().focus()},Y=function(at){at.preventDefault();var au=$(this).attr("data-target");$("#"+au).slideUp()},an=function(au,at){au.preventDefault();$("#form-comentario-contenedor").slideUp();$("#texto-comentario-contenedor").html(at.comentario);$("#comentario-contenedor").slideDown()},Z=function(au,at){if(at.reason=="hay_solicitud"||at.reason=="el_mismo"){alerts.showAlert(at.message)}},ab=function(au,at){$("#borrarCV").removeClass("hide");$("#verCV").removeClass("hide");$("#adjuntarCVVerTexto").addClass("hide");$("#cvError").addClass("hide")},L=function(au,at){$("#cvError").hide().removeClass("hide").addClass("bs-callout bs-callout-danger").html(at.message).slideDown()},ag=function(au,at){au.preventDefault();if(at!=undefined&&at.success==true){$("#borrarCV").addClass("hide");$("#verCV").addClass("hide");$("#adjuntarCVVerTexto").removeClass("hide");$("#cvError").addClass("hide")}else{$("#cvError").hide().addClass("bs-callout bs-callout-danger").html(at.message).slideDown()}},J=function(au,at){au.preventDefault();preventUnload=false;browser.redirect($(this).attr("data-url"))},M=function(at){at.preventDefault();$.when(ajax.post($(this))).done(function(au){i(au)})},P=function(au,at){i(at)},i=function(at){if(at!=undefined&&at.success==true){$("[id*=copyPrivacidad]").addClass("hide");if(at.data.nivel_privacidad==0){$("#select_privacidad").html($(".nivel-privacidad-0").html());$("#select_privacidad_privado").addClass("hide");$("#url_perfil").addClass("hide");$("#url_perfil_privado").removeClass("hide")}else{$("#select_privacidad").html($(".nivel-privacidad-2").html());$("#privacidad_status").html($("#select_privacidad_privado .nivel-privacidad-"+at.data.nivel_privacidad).html());$("#select_privacidad_privado").removeClass("hide");$("#url_perfil").removeClass("hide");$("#url_perfil_privado").addClass("hide");$("#copyPrivacidad"+at.data.nivel_privacidad).removeClass("hide")}}},T=function(){var aw=$.Deferred();var av=$("#p_select_habilidad").attr("data-url");var au="";var at=$("#p_sobre_mi").val();if(at){au+=at}$("[data-target=formEditarExperiencia]").each(function(ay){at=$(this).attr("data-params");if(at){at=JSON.parse(at);if(at.p_puesto){au+=" "+at.p_puesto}if(at.p_descripcion){au+=" "+at.p_descripcion}}});$("[data-target=formEditarFormacion]").each(function(ay){at=$(this).attr("data-params");if(at){at=JSON.parse(at);if(at.p_titulacion){au+=" "+at.p_titulacion}}});$("#idiomasContent").find(".label-default").each(function(ay){at=$(this).html();if(at){au+=" "+at}});at=$("#p_puesto_trabajo").val();if(at){au+=" "+at}if(au){var ax="texto="+encodeURIComponent(au);$.ajax({url:av,type:"post",data:ax,dataType:"json",async:true,success:function(ay){var aC=$("[data-target=formEditarHabilidades]").attr("data-params");if(aC){aC=JSON.parse(aC);aC=aC.p_habilidad;habs_actuales_array=aC.split(",")}else{$("#habilidadesContent").html("");$("#errorHabilidades").addClass("hide");aC="";habs_actuales_array=[]}for(var az in ay){if(habs_actuales_array.indexOf(ay[az])==-1){var aA=(aC)?",":"";aC=aC+aA+ay[az]}}$("#formEditarHabilidades #p_habilidad").val(aC).prop("disabled",false);var aB=new Object();aB.p_habilidad=aC;$("[data-target=formEditarHabilidades]").attr("data-params",JSON.stringify(aB));$("#formEditarHabilidades").append("<input type='hidden' name='sugeridas' value='1'>");$("#formEditarHabilidades").submit().on("success",function(){aw.resolve()}).on("error",function(){aw.resolve()});$("[name=sugeridas]").remove();$("#formEditarHabilidades button").prop("disabled",false)}})}return aw.promise()},af=function(au,at){$("#"+$(this).attr("data-target")).html(at.html).slideDown();formulario.hideFormulario($(this));j(au,at)},d=function(au){au.preventDefault();var at=$("#p_permalink");if(at.val()==""){at.val($(this).attr("data-permalink"))}$("#p_permalink").removeClass("hide").focus()},S=function(){var at=new RegExp("^http(s){0,1}://","g");if(at.exec($("#formEditarUrl #p_url").val())==null){$("#formEditarUrl #p_url").val("http://"+$("#formEditarUrl #p_url").val())}},ar=function(at){if($(this).is(":checked")){$(this).closest("form").find("#"+$(this).attr("data-target")).addClass("hide")}else{$(this).closest("form").find("#"+$(this).attr("data-target")).removeClass("hide")}},V=function(at){at.preventDefault();$.when(ajax.post($(this))).done(function(au){$("#formacion").html(au.html)})},aj=function(au,at){$("#"+$(this).attr("data-target")).html(at.html).slideDown();j(au,at)},j=function(au,at){au.preventDefault();if(at.errorLayers!=undefined&&$("#checkpc").length>0){$.each(at.errorLayers,function(av,aw){if(aw==true){$("#"+av).addClass("hide")}else{$("#"+av).removeClass("hide")}})}},p=function(au,at){$(".bootstrap-tagsinput span").remove();$("#dest_email").val("");$(".bootstrap-tagsinput input").val("");$("#dest_email").tagsinput("removeAll");if(at!=undefined&&at.success==true){$("#custom_contacts_form").hide();if(at.conectados){$("#conectados_count").html(parseInt($("#conectados_count").html())+parseInt(at.conectados.length));$.each(at.conectados,function(av,aw){$("#conectados_emails").removeClass("hidden").show();$("#conectados_emails ul").append("<li>"+aw+"</li>")})}$.when(ajax.loadLayer($(this).attr("data-url"),$(this).attr("data-target"),"paso=1")).done(function(){if($("#custom_contacts_tab").html()==""){$('a[href="#sended_contacts"]').tab("show")}})}else{if(at.message){$("#formErrorLayer").hide().removeClass("hide").html(at.message).slideDown()}}},ai=function(at){at.preventDefault();var au=$(this);if($("#p_select_habilidad").val()){habilidades.getEtiqueta()}},o=function(av,at){var au=$("#formInvitarEmail");formulario.showMessageLayer(au,at.message,true);au.find("#bodyMensajeInvitar").hide();au.find("#btnInvitacion").hide();au.find("#btnVolver").removeClass("hide")},m=function(au){var at=$.parseJSON($("[data-target=formEditarDatosPersonales]").attr("data-params"));if(!$("#p_fk_id_pais_permiso_trabajo").val()){if($(this).val()==at.p_fk_id_pais){$("#p_fk_id_pais_permiso_trabajo").val($(this).val())}}},ao=function(at){$(".btnsFormPerfilPrivado").removeClass("hide")},ac=function(at){$(".btnsFormPerfilPrivado").addClass("hide");$(".subir").click()},b=function(at){at.preventDefault();var au=$(this);$.when(ajax.post(au)).done(function(av){if(av.success){browser.redirect(au.attr("data-url-redirect"))}})},Q=function(at){at.preventDefault();var au=$(this);$.when(ajax.post(au)).done(function(av){if(av!=undefined&&av.success==true){au.closest(".alert").alert("close")}else{browser.reload()}})},N=function(at){at.preventDefault();$obj=$(this);q();$.when(ajax.post($obj)).done(function(au){U();if(au!=undefined&&au.success==true){browser.redirect(au.url)}})},R=function(au,at){if(at.success){boton.setAttributes($("#botonInvitarRed"),at.attributes)}},v=function(au,at){au.preventDefault();$("#formInfoLayer").hide().removeClass().addClass("bs-callout bs-callout-success").html(at.message).slideDown();formulario.hideFormulario($(this));$("#"+$(this).attr("data-target")).show()},ae=function(au,at){au.preventDefault();$("#formInfoLayer").hide().removeClass().addClass("bs-callout bs-callout-danger").html(at.message).slideDown()},u=function(au,at){au.preventDefault();$("[data-action=hide-form]").click()},O=function(au,at){au.preventDefault();$("#formInfoLayer").hide()},x=function(at){var au=$(this);if(au.attr("data-url")){$.when(alerts.showConfirm(au.attr("data-message"))).done(function(){$.when(ajax.post(au)).done(function(av){if(av!=undefined&&av.success==false){ae(at,av)}else{browser.redirect(av.url)}})})}else{alerts.showAlert(au.attr("data-message"))}},q=function(){var at=$("body").find("span[class=spinnerLoading]").clone().show();$obj.append(at)},U=function(){$obj.find("span[class=spinnerLoading]").remove()},t=function(au){au.preventDefault();var av=$(this);var at={};at.p_value=av.val();av.attr("data-params",'{"p_value": "'+av.val()+'"}');$.when(ajax.post(av)).done(function(aw){if(aw!=undefined&&aw.success==true){var ax=av.attr("data-target");$("#"+ax).html(aw.value)}})},A=function(at){at.preventDefault();var av=$(this);ajax.post(av);var au=av.attr("data-target");$("#"+au).modal("hide");window.open(av.attr("href"),av.attr("target"))},K=function(at){at.preventDefault();$tab=$("#"+$(this).attr("data-target"));$('a[href="#'+$(this).attr("data-target")+'"]').tab("show");e($tab,1)},r=function(at){at.preventDefault();$tab=$($(this).attr("href"));$("#"+$tab.attr("data-target")).html("");$("#sended_contacts .panel").hide();$("#sended_contacts .panel ul").html("");$("#exito_count").html(0);$("#conectados_count").html(0);$("#error_count").html(0);window.open($(this).attr("data-url"),$(this).attr("data-redirect"),"width=600,height=600,scrollbars=yes")},w=function(at){$("#custom_contacts_tab_loading").hide();$("#custom_contacts_tab").html("");$("#sended_contacts .panel").hide();$("#sended_contacts .panel ul").html("");$("#exito_count").html(0);$("#conectados_count").html(0);$("#error_count").html(0);$("#custom_contacts_form").show()},F=function(at){at.preventDefault();$('a[href="#sended_contacts"]').tab("show")},ad=function(at){at.preventDefault();$tab=$(this);e($tab,2)},e=function(av,au){var at=av;$.when(ajax.loadLayer(at.attr("data-url"),at.attr("data-target"),"paso="+au)).done(function(){if($("#"+at.attr("data-target")).html()==""){$('a[href="#sended_contacts"]').tab("show")}})},a=function(au){au.preventDefault();var at=new Array();$(this).find("input:checked").each(function(av,aw){at.push($(this).val())});$("[name=dest_email]").val(at.join(","));$(".inv.conocidos #invitaciones_sended .panel").addClass("hidden");$(".inv.conocidos #invitaciones_sended .panel .panel-title a").addClass("collapsed");$(".inv.conocidos #invitaciones_sended .panel .panel-collapse").addClass("collapse").removeClass("in");$(".inv.conocidos #invitaciones_sended .panel .panel-body ul li").remove();$(".inv.conocidos #exito_count, .inv.conocidos #conectados_count, .inv.conocidos #error_count").html("0")},s=function(au,at){$("[name=dest_email]").val("");if(at.exito){$("#exito_count").html(parseInt($("#exito_count").html())+parseInt(at.exito.length));$.each(at.exito,function(av,aw){$("#exito_emails").removeClass("hidden").show();$("#exito_emails ul").append("<li>"+aw+"</li>")})}if(at.conectados){$("#conectados_count").html(parseInt($("#conectados_count").html())+parseInt(at.conectados.length));$.each(at.conectados,function(av,aw){$("#conectados_emails").removeClass("hidden").show();$("#conectados_emails ul").append("<li>"+aw+"</li>")})}if(at.error){$("#error_count").html(parseInt($("#error_count").html())+parseInt(at.error.length));$.each(at.error,function(av,aw){$("#error_emails").removeClass("hidden").show();$("#error_emails ul").append("<li>"+aw+"</li>")})}if($("[name=paso]").val()==1){$("[data-action=saltar-paso]").click()}else{$('a[href="#sended_contacts"]').tab("show")}},ah=function(au,at){$("[name=dest_email]").val("");if(at.exito){$("#exito_count").html(parseInt($("#exito_count").html())+parseInt(at.exito.length));$.each(at.exito,function(av,aw){$("#exito_emails").removeClass("hidden").show();$("#exito_emails ul").append("<li>"+aw+"</li>");z(aw)});formulario.showGlobalMessageLayer(at.message,"success")}if(at.conectados){$("#conectados_count").html(parseInt($("#conectados_count").html())+parseInt(at.conectados.length));$.each(at.conectados,function(av,aw){$("#conectados_emails").removeClass("hidden").show();$("#conectados_emails ul").append("<li>"+aw+"</li>");z(aw)})}if(at.error){$("#error_count").html(parseInt($("#error_count").html())+parseInt(at.error.length));$.each(at.error,function(av,aw){$("#error_emails").removeClass("hidden").show();$("#error_emails ul").append("<li>"+aw+"</li>")})}},H=function(au,at){formulario.showGlobalMessageLayer(at.message,"danger")},z=function(at){if($("input:checked").length==1){if($("input:checked").val()==at){$("input:checked").closest("li").remove()}}else{$("input:checked").each(function(au,av){if($(this).val()==at){$(this).closest("li").remove()}})}},W=function(at){at.preventDefault();var au=!$(this).hasClass("active");$(this).siblings("ul").find(".btn input[type=checkbox]").each(function(){$(this).prop("checked",au);if(au){$(this).parents("label").addClass("active");$(this).parents("label").find(".glyphicon").addClass("glyphicon-ok").removeClass("glyphicon-plus")}else{$(this).parents("label").removeClass("active");$(this).parents("label").find(".glyphicon").removeClass("glyphicon-ok").addClass("glyphicon-plus")}})},k=function(at){at.preventDefault();var au=$(this).is(":checked");if(au){$(this).parents("label").find(".glyphicon").addClass("glyphicon-ok").removeClass("glyphicon-plus")}else{$(this).parents("label").find(".glyphicon").removeClass("glyphicon-ok").addClass("glyphicon-plus")}},c=function(au){au.stopPropagation();if($("#p_puesto_trabajo").val()){var at=T();$.when(at).then(function(){$("#formEditarPerfilPrivado").submit()})}else{$("#formEditarPerfilPrivado").submit()}},f=function(au,at){au.preventDefault();$(this).hide();$("#s_email").html(at.email);$("#baja_success").removeClass("hidden")};return{init:al,loadTabContactos:e}})();$(document).ready(function(){usuario.init()});var sitios=(function(){var f=function(){var i=$(".site-description [data-toggle=collapse]");i.on("click",d);var h=$("[data-action=seguir-publicador-sitios]");h.on("click",boton.sendRequest);h.on("success",c);observer.subscribe("seguidores-publicador",e);var g=$("[data-action=noseguir-publicador-sitios]");g.on("click",boton.sendRequest);g.on("success",c);$("body").on("change","[data-action=tabFiltros] select",b);$("body").on("submit","[data-action=tabFiltros]",vista.loadTabContent);$("body").on("click","[data-action=go-to-url]",a)},d=function(g){if($(this).hasClass("collapsed")){$(this).find("strong").html($(this).attr("data-in"))}else{$(this).find("strong").html($(this).attr("data-collapse"))}},c=function(h,g){observer.publish("seguidores-publicador",g.data.num_seguidores)},e=function(i){var h=$("#capa_publicador_seguidores");var g="";if(i==1){g=h.attr("data-text-singular")}else{g=h.attr("data-text-plural");g=g.replace("%s",i)}h.html(g)},b=function(g){$form=$(this).closest("[data-action=tabFiltros]");$form.submit()},a=function(g){browser.redirect($(this).attr("data-url"))};return{init:f}})();$(document).ready(function(){sitios.init()});